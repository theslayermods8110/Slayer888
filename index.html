<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor de Gráficos de Imagen</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f2f5;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1em;
            box-sizing: border-box;
        }

        .container {
            background: #fff;
            padding: 2em;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            text-align: center;
        }

        h1 {
            margin-bottom: 1em;
            color: #1a1a1a;
            font-size: 1.5em;
        }

        .image-container {
            margin: 2em 0;
            border: 2px dashed #ccc;
            padding: 1em;
            border-radius: 5px;
            min-height: 200px;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #fafafa;
        }

        #image-preview {
            max-width: 100%;
            max-height: 400px;
            border-radius: 5px;
            transition: filter 0.3s ease-in-out;
            display: none; /* Oculta hasta que se carga una imagen */
        }
        
        #placeholder-text {
            color: #888;
        }

        .controls {
            display: flex;
            flex-direction: column;
            gap: 1.5em;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-bottom: 1em;
            width: 100%;
        }

        .btn {
            border: 2px solid #007bff;
            color: white;
            background-color: #007bff;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            transition: background-color 0.3s, color 0.3s;
        }

        .btn:hover {
            background-color: #0056b3;
        }

        #image-upload {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .filter-group, .slider-group {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            text-align: left;
        }

        label {
            margin-bottom: 0.5em;
            font-weight: bold;
        }

        input[type="range"] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #ddd;
            border-radius: 5px;
            outline: none;
            opacity: 0.7;
            transition: opacity .2s;
        }

        input[type="range"]:hover {
            opacity: 1;
        }
        
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: #007bff;
            cursor: pointer;
            border-radius: 50%;
        }

        input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: #007bff;
            cursor: pointer;
            border-radius: 50%;
        }


        select {
            width: 100%;
            padding: 0.8em;
            border-radius: 5px;
            border: 1px solid #ccc;
            font-size: 1em;
        }

        .slider-group span {
            align-self: flex-end;
            margin-top: -1.5em;
            font-weight: bold;
            color: #555;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1em;
            margin-top: 1.5em;
        }

        .action-button {
             padding: 0.8em 1.5em;
            border: none;
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        #download-button {
            background-color: #28a745;
        }
        #download-button:hover {
            background-color: #218838;
        }
        #download-button:disabled {
            background-color: #a5d6a7;
            cursor: not-allowed;
        }

        #reset-button {
            background-color: #dc3545;
        }

        #reset-button:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>Editor de Gráficos de Imagen</h1>
        <div class="image-container">
            <span id="placeholder-text">Sube una imagen para ver la vista previa</span>
            <img id="image-preview" src="" alt="Vista previa de la imagen">
        </div>
        <div class="controls">
            <div class="file-input-wrapper">
                <button class="btn">Seleccionar Imagen</button>
                <input type="file" id="image-upload" accept="image/*">
            </div>
            <div class="filter-group">
                <label for="preset-filters">Filtros Preestablecidos (Estilo de Juego)</label>
                <select id="preset-filters">
                    <option value="none">Normal</option>
                    <option value="vivid">Vívido (Estilo iPhone)</option>
                    <option value="movie">Película (Estilo PUBG)</option>
                    <option value="dynamic">Dinámico (Estilo CoD)</option>
                </select>
            </div>
            <!-- === NUEVO SELECTOR DE HZ === -->
            <div class="filter-group">
                <label for="hz-selector">Efecto de Claridad (Tasa de Refresco)</label>
                <select id="hz-selector">
                    <option value="60">60 HZ (Estándar)</option>
                    <option value="90">90 HZ (Fluido)</option>
                    <option value="120">120 HZ (Extra Fluido)</option>
                    <option value="144">144 HZ (Máximo)</option>
                </select>
            </div>
            <div class="slider-group">
                <label for="brightness">Brillo</label>
                <input type="range" id="brightness" min="0" max="200" value="100">
                <span id="brightness-value">100%</span>
            </div>
            <div class="slider-group">
                <label for="contrast">Contraste</label>
                <input type="range" id="contrast" min="0" max="200" value="100">
                <span id="contrast-value">100%</span>
            </div>
            <div class="slider-group">
                <label for="saturate">Saturación</label>
                <input type="range" id="saturate" min="0" max="300" value="100">
                <span id="saturate-value">100%</span>
            </div>
            <div class="slider-group">
                <label for="sharpen">Desenfoque (Nitidez Invertida)</label>
                <input type="range" id="sharpen" min="0" max="5" value="0" step="0.1">
                <span id="sharpen-value">0px</span>
            </div>
            <div class="slider-group">
                <label for="hdr">Efecto HDR</label>
                <input type="range" id="hdr" min="0" max="100" value="0" step="1">
                <span id="hdr-value">0%</span>
            </div>
            <div class="button-group">
                <button id="download-button" class="action-button" disabled>Descargar Imagen</button>
                <button id="reset-button" class="action-button">Restablecer Filtros</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const imageUpload = document.getElementById('image-upload');
            const imagePreview = document.getElementById('image-preview');
            const placeholderText = document.getElementById('placeholder-text');

            const presetFilters = document.getElementById('preset-filters');
            const hzSelector = document.getElementById('hz-selector');
            const brightnessSlider = document.getElementById('brightness');
            const contrastSlider = document.getElementById('contrast');
            const saturateSlider = document.getElementById('saturate');
            const sharpenSlider = document.getElementById('sharpen');
            const hdrSlider = document.getElementById('hdr');
            
            const resetButton = document.getElementById('reset-button');
            const downloadButton = document.getElementById('download-button');

            const brightnessValue = document.getElementById('brightness-value');
            const contrastValue = document.getElementById('contrast-value');
            const saturateValue = document.getElementById('saturate-value');
            const sharpenValue = document.getElementById('sharpen-value');
            const hdrValue = document.getElementById('hdr-value');
            
            const initialValues = {
                brightness: 100,
                contrast: 100,
                saturate: 100,
                sharpen: 0,
                hdr: 0,
            };

            const sliders = [brightnessSlider, contrastSlider, saturateSlider, sharpenSlider, hdrSlider];

            imageUpload.addEventListener('change', (event) => {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.style.display = 'block';
                        placeholderText.style.display = 'none';
                        downloadButton.disabled = false;
                        resetAllControls();
                        applyFilters();
                    }
                    reader.readAsDataURL(file);
                }
            });

            function getFilterString() {
                if (!imagePreview.src) return 'none';

                const brightness = brightnessSlider.value;
                const contrast = contrastSlider.value;
                const saturate = saturateSlider.value;
                const sharpen = sharpenSlider.value;
                const hdrEffect = parseInt(hdrSlider.value);
                
                let hzBonusContrast = 0;
                let hzBonusSaturate = 0;
                switch(hzSelector.value) {
                    case '90':
                        hzBonusContrast = 5;
                        hzBonusSaturate = 10;
                        break;
                    case '120':
                        hzBonusContrast = 10;
                        hzBonusSaturate = 15;
                        break;
                    case '144':
                        hzBonusContrast = 15;
                        hzBonusSaturate = 20;
                        break;
                }

                const finalContrast = parseInt(contrast) + hdrEffect + hzBonusContrast;
                const finalSaturate = parseInt(saturate) + (hdrEffect / 2) + hzBonusSaturate;

                return `brightness(${brightness}%) contrast(${finalContrast}%) saturate(${finalSaturate}%) blur(${sharpen}px)`;
            }

            function applyFilters() {
                const filterString = getFilterString();
                imagePreview.style.filter = filterString;

                brightnessValue.textContent = `${brightnessSlider.value}%`;
                contrastValue.textContent = `${contrastSlider.value}%`;
                saturateValue.textContent = `${saturateSlider.value}%`;
                sharpenValue.textContent = `${sharpenSlider.value}px`;
                hdrValue.textContent = `${hdrSlider.value}%`;
            }

            presetFilters.addEventListener('change', () => {
                const selectedPreset = presetFilters.value;
                resetSliderValues();

                switch (selectedPreset) {
                    case 'vivid':
                        brightnessSlider.value = 115;
                        contrastSlider.value = 120;
                        saturateSlider.value = 165;
                        break;
                    case 'movie':
                        brightnessSlider.value = 95;
                        contrastSlider.value = 125;
                        saturateSlider.value = 110;
                        break;
                    case 'dynamic':
                        brightnessSlider.value = 105;
                        contrastSlider.value = 130;
                        saturateSlider.value = 125;
                        break;
                }
                applyFilters();
            });
            
            sliders.forEach(slider => slider.addEventListener('input', applyFilters));
            hzSelector.addEventListener('change', applyFilters);
            
            function resetSliderValues() {
                brightnessSlider.value = initialValues.brightness;
                contrastSlider.value = initialValues.contrast;
                saturateSlider.value = initialValues.saturate;
                sharpenSlider.value = initialValues.sharpen;
                hdrSlider.value = initialValues.hdr;
            }

            function resetAllControls() {
                resetSliderValues();
                presetFilters.value = 'none';
                hzSelector.value = '60';
            }

            resetButton.addEventListener('click', () => {
                if (!imagePreview.src) return;
                resetAllControls();
                applyFilters();
            });
            
            // --- NUEVA LÓGICA DE DESCARGA ---
            downloadButton.addEventListener('click', () => {
                if (!imagePreview.src || downloadButton.disabled) return;

                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();
                
                // Asegurar que la imagen cargue completamente antes de dibujarla
                img.onload = () => {
                    // Establecer las dimensiones del canvas igual a las de la imagen original
                    canvas.width = img.naturalWidth;
                    canvas.height = img.naturalHeight;

                    // Aplicar los filtros CSS al contexto del canvas
                    ctx.filter = getFilterString();

                    // Dibujar la imagen en el canvas. Los filtros se aplicarán en este paso.
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

                    // Crear el enlace de descarga
                    const link = document.createElement('a');
                    link.download = 'imagen-mejorada.png';
                    link.href = canvas.toDataURL('image/png'); // Obtener la URL de datos del canvas con los filtros
                    
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                };

                // Establecer el src de la nueva imagen para que se cargue.
                // Es importante hacer esto después de definir el .onload
                img.src = imagePreview.src;
            });

            // Aplicar filtros iniciales (default) al cargar
            applyFilters();
        });
    </script>
</body>
  </html>
